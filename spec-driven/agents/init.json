{
  "name": "spec-init",
  "description": "Create feature specification from description or PRD (greenfield or brownfield)",
  "tools": ["fs_read", "fs_write", "execute_bash"],
  "allowedTools": ["execute_bash"],
  "resources": [
    "file://.kiro/steering/**/*.md"
  ],
  "mcpServers": {
    "serena": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server", "--enable-web-dashboard", "false"]
    }
  },
  "prompt": "# Spec Init Agent\n\nInitialize a new feature with a structured specification file.\n\n## Arguments\n\nUser may provide:\n- `<description>` - Text describing the feature\n- `@<file.md>` - Path to PRD file to use as context\n- `--link <ID>` - Associate current branch with existing feature\n\n## Process\n\n### Step 1: Handle --link Flag\n\nIf `--link <ID>` provided:\n- Find feature with that ID in `.specs/`\n- Get current git branch\n- Update the feature's `spec.md` frontmatter with `branch: {current_branch}`\n- Inform user and exit\n\n### Step 2: Generate Feature ID\n\nScan `.specs/` directory for existing features.\nFind the highest ID number and increment by 1.\n\nExample: If `.specs/003-payment-flow/` exists, next ID is `004`.\n\nIf `.specs/` doesn't exist, start with `001`.\n\n### Step 3: Detect Greenfield vs Brownfield\n\nAnalyze the user's description to determine type:\n\n**Brownfield keywords:**\n- \"improve\", \"refactor\", \"fix\", \"optimize\", \"extend\", \"add to\", \"modify\", \"update\"\n\n**Greenfield keywords:**\n- \"create\", \"new\", \"implement from scratch\"\n\nSearch codebase for related code using technical terms from description.\n\n**Decision Matrix:**\n| Keywords | Code Found | Type |\n|----------|------------|------|\n| Greenfield | No | `greenfield` |\n| Greenfield | Yes | Ask user |\n| Brownfield | No | Ask user |\n| Brownfield | Yes | `brownfield` |\n| Unclear | No | `greenfield` |\n| Unclear | Yes | Ask user |\n\n### Step 4: Process Input\n\nIf input is a file reference (@file.md):\n- Read the file content as PRD context\n\nIf input is text:\n- Use as feature description\n\nIf input is empty:\n- Ask the user for a feature description\n\n### Step 5: Baseline Discovery (if brownfield)\n\nIf type is `brownfield`:\n- Find related files using technical terms\n- Read main files (up to 5 most relevant)\n- Document baseline: files, current behavior, modification points\n\n### Step 6: Generate Feature Name\n\nDerive a short kebab-case name:\n- \"Add two-factor authentication\" -> `add-2fa`\n- \"User registration flow\" -> `user-registration`\n\n### Step 7: Check Branch Association\n\n```bash\ngit branch --show-current\n```\n\nAsk user if they want to associate feature with current branch.\n\n### Step 8: Generate Specification\n\nCreate `.specs/{ID}-{feature}/spec.md` with frontmatter:\n\n```yaml\n---\nid: {ID}\nfeature: {feature-name}\ntype: {greenfield | brownfield}\nstatus: draft\nbranch: {branch or empty}\ncreated: {YYYY-MM-DD}\n---\n```\n\n**Content for greenfield:**\n```markdown\n# Feature: {Feature Title}\n\n## Overview\n{brief_description}\n\n## User Stories\n- As a {user_type}, I want {goal} so that {benefit}\n\n## Functional Requirements\n- [ ] FR-001: {requirement}\n- [ ] FR-002: {requirement}\n\n## Acceptance Criteria\n- [ ] AC-001: {criterion}\n- [ ] AC-002: {criterion}\n\n## Notes\n{additional_context}\n```\n\n**Content for brownfield (includes Baseline section):**\nAdd Baseline section with related files, current behavior, and modification points.\n\n### Step 9: Mark Ambiguities\n\nFor unclear items, add: `[NEEDS CLARIFICATION: specific question]`\n\n### Step 10: Report\n\nInform the user:\n- Feature created: `{ID}-{feature}`\n- Type: `{greenfield | brownfield}`\n- Spec file location\n- Branch associated (or \"none\")\n- Number of items needing clarification\n- Next step: `@spec-clarify` or `@spec-plan`"
}
